<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>CodeRay output</title>
  <style type="text/css">
.CodeRay .line-numbers a {
  text-decoration: inherit;
  color: inherit;
}
body {
  background-color: white;
  padding: 0;
  margin: 0;
}
.CodeRay {
  background-color: hsl(0,0%,95%);
  border: 1px solid silver;
  color: black;
}
.CodeRay pre {
  margin: 0px;
}

span.CodeRay { white-space: pre; border: 0px; padding: 2px; }

table.CodeRay { border-collapse: collapse; width: 100%; padding: 2px; }
table.CodeRay td { padding: 2px 4px; vertical-align: top; }

.CodeRay .line-numbers {
  background-color: hsl(180,65%,90%);
  color: gray;
  text-align: right;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
}
.CodeRay .line-numbers a {
  background-color: hsl(180,65%,90%) !important;
  color: gray !important;
  text-decoration: none !important;
}
.CodeRay .line-numbers pre {
  word-break: normal;
}
.CodeRay .line-numbers a:target { color: blue !important; }
.CodeRay .line-numbers .highlighted { color: red !important; }
.CodeRay .line-numbers .highlighted a { color: red !important; }
.CodeRay span.line-numbers { padding: 0px 4px; }
.CodeRay .line { display: block; float: left; width: 100%; }
.CodeRay .code { width: 100%; }

.CodeRay .debug { color: white !important; background: blue !important; }

.CodeRay .annotation { color:#007 }
.CodeRay .attribute-name { color:#b48 }
.CodeRay .attribute-value { color:#700 }
.CodeRay .binary { color:#549 }
.CodeRay .binary .char { color:#325 }
.CodeRay .binary .delimiter { color:#325 }
.CodeRay .char { color:#D20 }
.CodeRay .char .content { color:#D20 }
.CodeRay .char .delimiter { color:#710 }
.CodeRay .class { color:#B06; font-weight:bold }
.CodeRay .class-variable { color:#369 }
.CodeRay .color { color:#0A0 }
.CodeRay .comment { color:#777 }
.CodeRay .comment .char { color:#444 }
.CodeRay .comment .delimiter { color:#444 }
.CodeRay .constant { color:#036; font-weight:bold }
.CodeRay .decorator { color:#B0B }
.CodeRay .definition { color:#099; font-weight:bold }
.CodeRay .delimiter { color:black }
.CodeRay .directive { color:#088; font-weight:bold }
.CodeRay .docstring { color:#D42; }
.CodeRay .doctype { color:#34b }
.CodeRay .done { text-decoration: line-through; color: gray }
.CodeRay .entity { color:#800; font-weight:bold }
.CodeRay .error { color:#F00; background-color:#FAA }
.CodeRay .escape  { color:#666 }
.CodeRay .exception { color:#C00; font-weight:bold }
.CodeRay .float { color:#60E }
.CodeRay .function { color:#06B; font-weight:bold }
.CodeRay .function .delimiter { color:#024; font-weight:bold }
.CodeRay .global-variable { color:#d70 }
.CodeRay .hex { color:#02b }
.CodeRay .id  { color:#33D; font-weight:bold }
.CodeRay .include { color:#B44; font-weight:bold }
.CodeRay .inline { background-color: hsla(0,0%,0%,0.07); color: black }
.CodeRay .inline-delimiter { font-weight: bold; color: #666 }
.CodeRay .instance-variable { color:#33B }
.CodeRay .integer  { color:#00D }
.CodeRay .imaginary { color:#f00 }
.CodeRay .important { color:#D00 }
.CodeRay .key { color: #606 }
.CodeRay .key .char { color: #60f }
.CodeRay .key .delimiter { color: #404 }
.CodeRay .keyword { color:#080; font-weight:bold }
.CodeRay .label { color:#970; font-weight:bold }
.CodeRay .local-variable { color:#950 }
.CodeRay .map .content { color:#808 }
.CodeRay .map .delimiter { color:#40A}
.CodeRay .map { background-color:hsla(200,100%,50%,0.06); }
.CodeRay .namespace { color:#707; font-weight:bold }
.CodeRay .octal { color:#40E }
.CodeRay .operator { }
.CodeRay .predefined { color:#369; font-weight:bold }
.CodeRay .predefined-constant { color:#069 }
.CodeRay .predefined-type { color:#0a8; font-weight:bold }
.CodeRay .preprocessor { color:#579 }
.CodeRay .pseudo-class { color:#00C; font-weight:bold }
.CodeRay .regexp { background-color:hsla(300,100%,50%,0.06); }
.CodeRay .regexp .content { color:#808 }
.CodeRay .regexp .delimiter { color:#404 }
.CodeRay .regexp .modifier { color:#C2C }
.CodeRay .reserved { color:#080; font-weight:bold }
.CodeRay .shell { background-color:hsla(120,100%,50%,0.06); }
.CodeRay .shell .content { color:#2B2 }
.CodeRay .shell .delimiter { color:#161 }
.CodeRay .string { background-color:hsla(0,100%,50%,0.05); }
.CodeRay .string .char { color: #b0b }
.CodeRay .string .content { color: #D20 }
.CodeRay .string .delimiter { color: #710 }
.CodeRay .string .modifier { color: #E40 }
.CodeRay .symbol { color:#A60 }
.CodeRay .symbol .content { color:#A60 }
.CodeRay .symbol .delimiter { color:#740 }
.CodeRay .tag { color:#070; font-weight:bold }
.CodeRay .type { color:#339; font-weight:bold }
.CodeRay .value { color: #088 }
.CodeRay .variable { color:#037 }

.CodeRay .insert { background: hsla(120,100%,50%,0.12) }
.CodeRay .delete { background: hsla(0,100%,50%,0.12) }
.CodeRay .change { color: #bbf; background: #007 }
.CodeRay .head { color: #f8f; background: #505 }
.CodeRay .head .filename { color: white; }

.CodeRay .delete .eyecatcher { background-color: hsla(0,100%,50%,0.2); border: 1px solid hsla(0,100%,45%,0.5); margin: -1px; border-bottom: none; border-top-left-radius: 5px; border-top-right-radius: 5px; }
.CodeRay .insert .eyecatcher { background-color: hsla(120,100%,50%,0.2); border: 1px solid hsla(120,100%,25%,0.5); margin: -1px; border-top: none; border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; }

.CodeRay .insert .insert { color: #0c0; background:transparent; font-weight:bold }
.CodeRay .delete .delete { color: #c00; background:transparent; font-weight:bold }
.CodeRay .change .change { color: #88f }
.CodeRay .head .head { color: #f4f }

.CodeRay {
  border: none;
}
  </style>
</head>
<body>

<table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
<a href="#n14" name="n14">14</a>
<a href="#n15" name="n15">15</a>
<a href="#n16" name="n16">16</a>
<a href="#n17" name="n17">17</a>
<a href="#n18" name="n18">18</a>
<a href="#n19" name="n19">19</a>
<strong><a href="#n20" name="n20">20</a></strong>
<a href="#n21" name="n21">21</a>
<a href="#n22" name="n22">22</a>
<a href="#n23" name="n23">23</a>
<a href="#n24" name="n24">24</a>
<a href="#n25" name="n25">25</a>
<a href="#n26" name="n26">26</a>
<a href="#n27" name="n27">27</a>
<a href="#n28" name="n28">28</a>
<a href="#n29" name="n29">29</a>
<strong><a href="#n30" name="n30">30</a></strong>
<a href="#n31" name="n31">31</a>
<a href="#n32" name="n32">32</a>
<a href="#n33" name="n33">33</a>
<a href="#n34" name="n34">34</a>
<a href="#n35" name="n35">35</a>
<a href="#n36" name="n36">36</a>
<a href="#n37" name="n37">37</a>
<a href="#n38" name="n38">38</a>
<a href="#n39" name="n39">39</a>
<strong><a href="#n40" name="n40">40</a></strong>
<a href="#n41" name="n41">41</a>
<a href="#n42" name="n42">42</a>
<a href="#n43" name="n43">43</a>
<a href="#n44" name="n44">44</a>
<a href="#n45" name="n45">45</a>
<a href="#n46" name="n46">46</a>
<a href="#n47" name="n47">47</a>
<a href="#n48" name="n48">48</a>
<a href="#n49" name="n49">49</a>
<strong><a href="#n50" name="n50">50</a></strong>
<a href="#n51" name="n51">51</a>
<a href="#n52" name="n52">52</a>
<a href="#n53" name="n53">53</a>
<a href="#n54" name="n54">54</a>
<a href="#n55" name="n55">55</a>
<a href="#n56" name="n56">56</a>
<a href="#n57" name="n57">57</a>
<a href="#n58" name="n58">58</a>
<a href="#n59" name="n59">59</a>
<strong><a href="#n60" name="n60">60</a></strong>
<a href="#n61" name="n61">61</a>
<a href="#n62" name="n62">62</a>
<a href="#n63" name="n63">63</a>
<a href="#n64" name="n64">64</a>
<a href="#n65" name="n65">65</a>
<a href="#n66" name="n66">66</a>
<a href="#n67" name="n67">67</a>
<a href="#n68" name="n68">68</a>
<a href="#n69" name="n69">69</a>
<strong><a href="#n70" name="n70">70</a></strong>
<a href="#n71" name="n71">71</a>
<a href="#n72" name="n72">72</a>
<a href="#n73" name="n73">73</a>
<a href="#n74" name="n74">74</a>
<a href="#n75" name="n75">75</a>
<a href="#n76" name="n76">76</a>
<a href="#n77" name="n77">77</a>
<a href="#n78" name="n78">78</a>
<a href="#n79" name="n79">79</a>
<strong><a href="#n80" name="n80">80</a></strong>
<a href="#n81" name="n81">81</a>
<a href="#n82" name="n82">82</a>
<a href="#n83" name="n83">83</a>
<a href="#n84" name="n84">84</a>
<a href="#n85" name="n85">85</a>
<a href="#n86" name="n86">86</a>
<a href="#n87" name="n87">87</a>
<a href="#n88" name="n88">88</a>
<a href="#n89" name="n89">89</a>
<strong><a href="#n90" name="n90">90</a></strong>
<a href="#n91" name="n91">91</a>
<a href="#n92" name="n92">92</a>
<a href="#n93" name="n93">93</a>
<a href="#n94" name="n94">94</a>
<a href="#n95" name="n95">95</a>
<a href="#n96" name="n96">96</a>
<a href="#n97" name="n97">97</a>
<a href="#n98" name="n98">98</a>
<a href="#n99" name="n99">99</a>
<strong><a href="#n100" name="n100">100</a></strong>
<a href="#n101" name="n101">101</a>
<a href="#n102" name="n102">102</a>
<a href="#n103" name="n103">103</a>
<a href="#n104" name="n104">104</a>
<a href="#n105" name="n105">105</a>
<a href="#n106" name="n106">106</a>
<a href="#n107" name="n107">107</a>
<a href="#n108" name="n108">108</a>
<a href="#n109" name="n109">109</a>
<strong><a href="#n110" name="n110">110</a></strong>
<a href="#n111" name="n111">111</a>
<a href="#n112" name="n112">112</a>
<a href="#n113" name="n113">113</a>
<a href="#n114" name="n114">114</a>
<a href="#n115" name="n115">115</a>
<a href="#n116" name="n116">116</a>
<a href="#n117" name="n117">117</a>
<a href="#n118" name="n118">118</a>
<a href="#n119" name="n119">119</a>
<strong><a href="#n120" name="n120">120</a></strong>
<a href="#n121" name="n121">121</a>
<a href="#n122" name="n122">122</a>
<a href="#n123" name="n123">123</a>
<a href="#n124" name="n124">124</a>
<a href="#n125" name="n125">125</a>
<a href="#n126" name="n126">126</a>
<a href="#n127" name="n127">127</a>
<a href="#n128" name="n128">128</a>
<a href="#n129" name="n129">129</a>
<strong><a href="#n130" name="n130">130</a></strong>
<a href="#n131" name="n131">131</a>
<a href="#n132" name="n132">132</a>
<a href="#n133" name="n133">133</a>
<a href="#n134" name="n134">134</a>
<a href="#n135" name="n135">135</a>
<a href="#n136" name="n136">136</a>
<a href="#n137" name="n137">137</a>
<a href="#n138" name="n138">138</a>
<a href="#n139" name="n139">139</a>
<strong><a href="#n140" name="n140">140</a></strong>
<a href="#n141" name="n141">141</a>
<a href="#n142" name="n142">142</a>
<a href="#n143" name="n143">143</a>
<a href="#n144" name="n144">144</a>
<a href="#n145" name="n145">145</a>
<a href="#n146" name="n146">146</a>
<a href="#n147" name="n147">147</a>
<a href="#n148" name="n148">148</a>
<a href="#n149" name="n149">149</a>
<strong><a href="#n150" name="n150">150</a></strong>
<a href="#n151" name="n151">151</a>
<a href="#n152" name="n152">152</a>
<a href="#n153" name="n153">153</a>
<a href="#n154" name="n154">154</a>
<a href="#n155" name="n155">155</a>
<a href="#n156" name="n156">156</a>
<a href="#n157" name="n157">157</a>
<a href="#n158" name="n158">158</a>
<a href="#n159" name="n159">159</a>
<strong><a href="#n160" name="n160">160</a></strong>
<a href="#n161" name="n161">161</a>
<a href="#n162" name="n162">162</a>
<a href="#n163" name="n163">163</a>
<a href="#n164" name="n164">164</a>
<a href="#n165" name="n165">165</a>
<a href="#n166" name="n166">166</a>
<a href="#n167" name="n167">167</a>
<a href="#n168" name="n168">168</a>
<a href="#n169" name="n169">169</a>
<strong><a href="#n170" name="n170">170</a></strong>
<a href="#n171" name="n171">171</a>
<a href="#n172" name="n172">172</a>
<a href="#n173" name="n173">173</a>
<a href="#n174" name="n174">174</a>
<a href="#n175" name="n175">175</a>
<a href="#n176" name="n176">176</a>
<a href="#n177" name="n177">177</a>
<a href="#n178" name="n178">178</a>
<a href="#n179" name="n179">179</a>
<strong><a href="#n180" name="n180">180</a></strong>
<a href="#n181" name="n181">181</a>
<a href="#n182" name="n182">182</a>
<a href="#n183" name="n183">183</a>
<a href="#n184" name="n184">184</a>
<a href="#n185" name="n185">185</a>
<a href="#n186" name="n186">186</a>
<a href="#n187" name="n187">187</a>
<a href="#n188" name="n188">188</a>
<a href="#n189" name="n189">189</a>
<strong><a href="#n190" name="n190">190</a></strong>
<a href="#n191" name="n191">191</a>
<a href="#n192" name="n192">192</a>
<a href="#n193" name="n193">193</a>
<a href="#n194" name="n194">194</a>
<a href="#n195" name="n195">195</a>
<a href="#n196" name="n196">196</a>
<a href="#n197" name="n197">197</a>
<a href="#n198" name="n198">198</a>
<a href="#n199" name="n199">199</a>
<strong><a href="#n200" name="n200">200</a></strong>
<a href="#n201" name="n201">201</a>
<a href="#n202" name="n202">202</a>
<a href="#n203" name="n203">203</a>
<a href="#n204" name="n204">204</a>
<a href="#n205" name="n205">205</a>
<a href="#n206" name="n206">206</a>
<a href="#n207" name="n207">207</a>
<a href="#n208" name="n208">208</a>
<a href="#n209" name="n209">209</a>
<strong><a href="#n210" name="n210">210</a></strong>
<a href="#n211" name="n211">211</a>
<a href="#n212" name="n212">212</a>
<a href="#n213" name="n213">213</a>
<a href="#n214" name="n214">214</a>
<a href="#n215" name="n215">215</a>
<a href="#n216" name="n216">216</a>
<a href="#n217" name="n217">217</a>
<a href="#n218" name="n218">218</a>
<a href="#n219" name="n219">219</a>
<strong><a href="#n220" name="n220">220</a></strong>
<a href="#n221" name="n221">221</a>
<a href="#n222" name="n222">222</a>
<a href="#n223" name="n223">223</a>
<a href="#n224" name="n224">224</a>
<a href="#n225" name="n225">225</a>
<a href="#n226" name="n226">226</a>
<a href="#n227" name="n227">227</a>
<a href="#n228" name="n228">228</a>
<a href="#n229" name="n229">229</a>
<strong><a href="#n230" name="n230">230</a></strong>
<a href="#n231" name="n231">231</a>
<a href="#n232" name="n232">232</a>
<a href="#n233" name="n233">233</a>
<a href="#n234" name="n234">234</a>
<a href="#n235" name="n235">235</a>
<a href="#n236" name="n236">236</a>
<a href="#n237" name="n237">237</a>
<a href="#n238" name="n238">238</a>
<a href="#n239" name="n239">239</a>
<strong><a href="#n240" name="n240">240</a></strong>
<a href="#n241" name="n241">241</a>
<a href="#n242" name="n242">242</a>
<a href="#n243" name="n243">243</a>
<a href="#n244" name="n244">244</a>
<a href="#n245" name="n245">245</a>
<a href="#n246" name="n246">246</a>
<a href="#n247" name="n247">247</a>
<a href="#n248" name="n248">248</a>
<a href="#n249" name="n249">249</a>
<strong><a href="#n250" name="n250">250</a></strong>
<a href="#n251" name="n251">251</a>
<a href="#n252" name="n252">252</a>
<a href="#n253" name="n253">253</a>
<a href="#n254" name="n254">254</a>
<a href="#n255" name="n255">255</a>
<a href="#n256" name="n256">256</a>
<a href="#n257" name="n257">257</a>
<a href="#n258" name="n258">258</a>
<a href="#n259" name="n259">259</a>
<strong><a href="#n260" name="n260">260</a></strong>
</pre></td>
  <td class="code"><pre><span class="comment">/**
 * JSONSchema Validator - Validates JavaScript objects using JSON Schemas
 *        (http://www.json.com/json-schema-proposal/)
 *
 * Copyright (c) 2007 Kris Zyp SitePen (www.sitepen.com)
 * Licensed under the MIT (MIT-LICENSE.txt) license.
To use the validator call the validate function with an instance object and an optional schema object.
If a schema is provided, it will be used to validate. If the instance object refers to a schema (self-validating),
that schema will be used to validate and the schema parameter is not necessary (if both exist,
both validations will occur).
The validate method will return an array of validation errors. If there are no errors, then an
empty list will be returned. A validation error will have two properties:
&quot;property&quot; which indicates which property had the error
&quot;message&quot; which indicates what the error was
 */</span>
({<span class="key">define</span>:<span class="keyword">typeof</span> define!=<span class="string"><span class="delimiter">&quot;</span><span class="content">undefined</span><span class="delimiter">&quot;</span></span>?<span class="function">define</span>:<span class="keyword">function</span>(deps, factory){module.exports = factory();}}).
define([], <span class="keyword">function</span>(){
<span class="keyword">var</span> exports = validate;
<span class="comment">// setup primitive classes to be JSON Schema types</span>
exports.Integer = {<span class="key">type</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">integer</span><span class="delimiter">&quot;</span></span>};
<span class="keyword">var</span> primitiveConstructors = {
        <span class="key">String</span>: String,
        <span class="key">Boolean</span>: Boolean,
        <span class="key">Number</span>: Number,
        <span class="key">Object</span>: Object,
        <span class="key">Array</span>: Array,
        <span class="key">Date</span>: Date
}
exports.validate = validate;
<span class="keyword">function</span> <span class="function">validate</span>(<span class="comment">/*Any*/</span>instance,<span class="comment">/*Object*/</span>schema) {
                <span class="comment">// Summary:</span>
                <span class="comment">//          To use the validator call JSONSchema.validate with an instance object and an optional schema object.</span>
                <span class="comment">//                 If a schema is provided, it will be used to validate. If the instance object refers to a schema (self-validating),</span>
                <span class="comment">//                 that schema will be used to validate and the schema parameter is not necessary (if both exist,</span>
                <span class="comment">//                 both validations will occur).</span>
                <span class="comment">//                 The validate method will return an object with two properties:</span>
                <span class="comment">//                         valid: A boolean indicating if the instance is valid by the schema</span>
                <span class="comment">//                         errors: An array of validation errors. If there are no errors, then an</span>
                <span class="comment">//                                         empty list will be returned. A validation error will have two properties:</span>
                <span class="comment">//                                                 property: which indicates which property had the error</span>
                <span class="comment">//                                                 message: which indicates what the error was</span>
                <span class="comment">//</span>
                <span class="keyword">return</span> validate(instance, schema, {<span class="key">changing</span>: <span class="predefined-constant">false</span>});<span class="comment">//, coerce: false, existingOnly: false});</span>
        };
exports.<span class="function">checkPropertyChange</span> = <span class="keyword">function</span>(<span class="comment">/*Any*/</span>value,<span class="comment">/*Object*/</span>schema, <span class="comment">/*String*/</span>property) {
                <span class="comment">// Summary:</span>
                <span class="comment">//                 The checkPropertyChange method will check to see if an value can legally be in property with the given schema</span>
                <span class="comment">//                 This is slightly different than the validate method in that it will fail if the schema is readonly and it will</span>
                <span class="comment">//                 not check for self-validation, it is assumed that the passed in value is already internally valid.</span>
                <span class="comment">//                 The checkPropertyChange method will return the same object type as validate, see JSONSchema.validate for</span>
                <span class="comment">//                 information.</span>
                <span class="comment">//</span>
                <span class="keyword">return</span> validate(value, schema, {<span class="key">changing</span>: property || <span class="string"><span class="delimiter">&quot;</span><span class="content">property</span><span class="delimiter">&quot;</span></span>});
        };
<span class="keyword">var</span> validate = exports.<span class="function">_validate</span> = <span class="keyword">function</span>(<span class="comment">/*Any*/</span>instance,<span class="comment">/*Object*/</span>schema,<span class="comment">/*Object*/</span>options) {

        <span class="keyword">if</span> (!options) options = {};
        <span class="keyword">var</span> _changing = options.changing;

        <span class="keyword">function</span> <span class="function">getType</span>(schema){
                <span class="keyword">return</span> schema.type || (primitiveConstructors[schema.name] == schema &amp;&amp; schema.name.toLowerCase());
        }
        <span class="keyword">var</span> errors = [];
        <span class="comment">// validate a value against a property definition</span>
        <span class="keyword">function</span> <span class="function">checkProp</span>(value, schema, path,i){

                <span class="keyword">var</span> l;
                path += path ? <span class="keyword">typeof</span> i == <span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span> ? <span class="string"><span class="delimiter">'</span><span class="content">[</span><span class="delimiter">'</span></span> + i + <span class="string"><span class="delimiter">'</span><span class="content">]</span><span class="delimiter">'</span></span> : <span class="keyword">typeof</span> i == <span class="string"><span class="delimiter">'</span><span class="content">undefined</span><span class="delimiter">'</span></span> ? <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span> : <span class="string"><span class="delimiter">'</span><span class="content">.</span><span class="delimiter">'</span></span> + i : i;
                <span class="keyword">function</span> <span class="function">addError</span>(message){
                        errors.push({<span class="key">property</span>:path,<span class="key">message</span>:message});
                }

                <span class="keyword">if</span>((<span class="keyword">typeof</span> schema != <span class="string"><span class="delimiter">'</span><span class="content">object</span><span class="delimiter">'</span></span> || schema <span class="keyword">instanceof</span> Array) &amp;&amp; (path || <span class="keyword">typeof</span> schema != <span class="string"><span class="delimiter">'</span><span class="content">function</span><span class="delimiter">'</span></span>) &amp;&amp; !(schema &amp;&amp; getType(schema))){
                        <span class="keyword">if</span>(<span class="keyword">typeof</span> schema == <span class="string"><span class="delimiter">'</span><span class="content">function</span><span class="delimiter">'</span></span>){
                                <span class="keyword">if</span>(!(value <span class="keyword">instanceof</span> schema)){
                                        addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">is not an instance of the class/constructor </span><span class="delimiter">&quot;</span></span> + schema.name);
                                }
                        }<span class="keyword">else</span> <span class="keyword">if</span>(schema){
                                addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid schema/property definition </span><span class="delimiter">&quot;</span></span> + schema);
                        }
                        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
                }
                <span class="keyword">if</span>(_changing &amp;&amp; schema.readonly){
                        addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">is a readonly field, it can not be changed</span><span class="delimiter">&quot;</span></span>);
                }
                <span class="keyword">if</span>(schema[<span class="string"><span class="delimiter">'</span><span class="content">extends</span><span class="delimiter">'</span></span>]){ <span class="comment">// if it extends another schema, it must pass that schema as well</span>
                        checkProp(value,schema[<span class="string"><span class="delimiter">'</span><span class="content">extends</span><span class="delimiter">'</span></span>],path,i);
                }
                <span class="comment">// validate a value against a type definition</span>
                <span class="keyword">function</span> <span class="function">checkType</span>(type,value){
                        <span class="keyword">if</span>(type){
                                <span class="keyword">if</span>(<span class="keyword">typeof</span> type == <span class="string"><span class="delimiter">'</span><span class="content">string</span><span class="delimiter">'</span></span> &amp;&amp; type != <span class="string"><span class="delimiter">'</span><span class="content">any</span><span class="delimiter">'</span></span> &amp;&amp;
                                                (type == <span class="string"><span class="delimiter">'</span><span class="content">null</span><span class="delimiter">'</span></span> ? value !== <span class="predefined-constant">null</span> : <span class="keyword">typeof</span> value != type) &amp;&amp;
                                                !(value <span class="keyword">instanceof</span> Array &amp;&amp; type == <span class="string"><span class="delimiter">'</span><span class="content">array</span><span class="delimiter">'</span></span>) &amp;&amp;
                                                !(value <span class="keyword">instanceof</span> Date &amp;&amp; type == <span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>) &amp;&amp;
                                                !(type == <span class="string"><span class="delimiter">'</span><span class="content">integer</span><span class="delimiter">'</span></span> &amp;&amp; value%<span class="integer">1</span>===<span class="integer">0</span>)){
                                        <span class="keyword">return</span> [{<span class="key">property</span>:path,<span class="key">message</span>:(<span class="keyword">typeof</span> value) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> value found, but a </span><span class="delimiter">&quot;</span></span> + type + <span class="string"><span class="delimiter">&quot;</span><span class="content"> is required</span><span class="delimiter">&quot;</span></span>}];
                                }
                                <span class="keyword">if</span>(type <span class="keyword">instanceof</span> Array){
                                        <span class="keyword">var</span> unionErrors=[];
                                        <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="integer">0</span>; j &lt; type.length; j++){ <span class="comment">// a union type</span>
                                                <span class="keyword">if</span>(!(unionErrors=checkType(type[j],value)).length){
                                                        <span class="keyword">break</span>;
                                                }
                                        }
                                        <span class="keyword">if</span>(unionErrors.length){
                                                <span class="keyword">return</span> unionErrors;
                                        }
                                }<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> type == <span class="string"><span class="delimiter">'</span><span class="content">object</span><span class="delimiter">'</span></span>){
                                        <span class="keyword">var</span> priorErrors = errors;
                                        errors = [];
                                        checkProp(value,type,path);
                                        <span class="keyword">var</span> theseErrors = errors;
                                        errors = priorErrors;
                                        <span class="keyword">return</span> theseErrors;
                                }
                        }
                        <span class="keyword">return</span> [];
                }
                <span class="keyword">if</span>(value === <span class="predefined-constant">undefined</span>){
                        <span class="keyword">if</span>(schema.required){
                                addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">is missing and it is required</span><span class="delimiter">&quot;</span></span>);
                        }
                }<span class="keyword">else</span>{
                        errors = errors.concat(checkType(getType(schema),value));
                        <span class="keyword">if</span>(schema.disallow &amp;&amp; !checkType(schema.disallow,value).length){
                                addError(<span class="string"><span class="delimiter">&quot;</span><span class="content"> disallowed value was matched</span><span class="delimiter">&quot;</span></span>);
                        }
                        <span class="keyword">if</span>(value !== <span class="predefined-constant">null</span>){
                                <span class="keyword">if</span>(value <span class="keyword">instanceof</span> Array){
                                        <span class="keyword">if</span>(schema.items){
                                                <span class="keyword">var</span> itemsIsArray = schema.items <span class="keyword">instanceof</span> Array;
                                                <span class="keyword">var</span> propDef = schema.items;
                                                <span class="keyword">for</span> (i = <span class="integer">0</span>, l = value.length; i &lt; l; i += <span class="integer">1</span>) {
                                                        <span class="keyword">if</span> (itemsIsArray)
                                                                propDef = schema.items[i];
                                                        <span class="keyword">if</span> (options.coerce)
                                                                value[i] = options.coerce(value[i], propDef);
                                                        errors.concat(checkProp(value[i],propDef,path,i));
                                                }
                                        }
                                        <span class="keyword">if</span>(schema.minItems &amp;&amp; value.length &lt; schema.minItems){
                                                addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">There must be a minimum of </span><span class="delimiter">&quot;</span></span> + schema.minItems + <span class="string"><span class="delimiter">&quot;</span><span class="content"> in the array</span><span class="delimiter">&quot;</span></span>);
                                        }
                                        <span class="keyword">if</span>(schema.maxItems &amp;&amp; value.length &gt; schema.maxItems){
                                                addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">There must be a maximum of </span><span class="delimiter">&quot;</span></span> + schema.maxItems + <span class="string"><span class="delimiter">&quot;</span><span class="content"> in the array</span><span class="delimiter">&quot;</span></span>);
                                        }
                                }<span class="keyword">else</span> <span class="keyword">if</span>(schema.properties || schema.additionalProperties){
                                        errors.concat(checkObj(value, schema.properties, path, schema.additionalProperties));
                                }
                                <span class="keyword">if</span>(schema.pattern &amp;&amp; <span class="keyword">typeof</span> value == <span class="string"><span class="delimiter">'</span><span class="content">string</span><span class="delimiter">'</span></span> &amp;&amp; !value.match(schema.pattern)){
                                        addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">does not match the regex pattern </span><span class="delimiter">&quot;</span></span> + schema.pattern);
                                }
                                <span class="keyword">if</span>(schema.maxLength &amp;&amp; <span class="keyword">typeof</span> value == <span class="string"><span class="delimiter">'</span><span class="content">string</span><span class="delimiter">'</span></span> &amp;&amp; value.length &gt; schema.maxLength){
                                        addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">may only be </span><span class="delimiter">&quot;</span></span> + schema.maxLength + <span class="string"><span class="delimiter">&quot;</span><span class="content"> characters long</span><span class="delimiter">&quot;</span></span>);
                                }
                                <span class="keyword">if</span>(schema.minLength &amp;&amp; <span class="keyword">typeof</span> value == <span class="string"><span class="delimiter">'</span><span class="content">string</span><span class="delimiter">'</span></span> &amp;&amp; value.length &lt; schema.minLength){
                                        addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">must be at least </span><span class="delimiter">&quot;</span></span> + schema.minLength + <span class="string"><span class="delimiter">&quot;</span><span class="content"> characters long</span><span class="delimiter">&quot;</span></span>);
                                }
                                <span class="keyword">if</span>(<span class="keyword">typeof</span> schema.minimum !== <span class="predefined-constant">undefined</span> &amp;&amp; <span class="keyword">typeof</span> value == <span class="keyword">typeof</span> schema.minimum &amp;&amp;
                                                schema.minimum &gt; value){
                                        addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">must have a minimum value of </span><span class="delimiter">&quot;</span></span> + schema.minimum);
                                }
                                <span class="keyword">if</span>(<span class="keyword">typeof</span> schema.maximum !== <span class="predefined-constant">undefined</span> &amp;&amp; <span class="keyword">typeof</span> value == <span class="keyword">typeof</span> schema.maximum &amp;&amp;
                                                schema.maximum &lt; value){
                                        addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">must have a maximum value of </span><span class="delimiter">&quot;</span></span> + schema.maximum);
                                }
                                <span class="keyword">if</span>(schema[<span class="string"><span class="delimiter">'</span><span class="content">enum</span><span class="delimiter">'</span></span>]){
                                        <span class="keyword">var</span> enumer = schema[<span class="string"><span class="delimiter">'</span><span class="content">enum</span><span class="delimiter">'</span></span>];
                                        l = enumer.length;
                                        <span class="keyword">var</span> found;
                                        <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="integer">0</span>; j &lt; l; j++){
                                                <span class="keyword">if</span>(enumer[j]===value){
                                                        found=<span class="integer">1</span>;
                                                        <span class="keyword">break</span>;
                                                }
                                        }
                                        <span class="keyword">if</span>(!found){
                                                addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">does not have a value in the enumeration </span><span class="delimiter">&quot;</span></span> + enumer.join(<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>));
                                        }
                                }
                                <span class="keyword">if</span>(<span class="keyword">typeof</span> schema.maxDecimal == <span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span> &amp;&amp;
                                        (value.toString().match(<span class="keyword">new</span> RegExp(<span class="string"><span class="delimiter">&quot;</span><span class="char">\\</span><span class="content">.[0-9]{</span><span class="delimiter">&quot;</span></span> + (schema.maxDecimal + <span class="integer">1</span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content">,}</span><span class="delimiter">&quot;</span></span>)))){
                                        addError(<span class="string"><span class="delimiter">&quot;</span><span class="content">may only have </span><span class="delimiter">&quot;</span></span> + schema.maxDecimal + <span class="string"><span class="delimiter">&quot;</span><span class="content"> digits of decimal places</span><span class="delimiter">&quot;</span></span>);
                                }
                        }
                }
                <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }
        <span class="comment">// validate an object against a schema</span>
        <span class="keyword">function</span> <span class="function">checkObj</span>(instance,objTypeDef,path,additionalProp){

                <span class="keyword">if</span>(<span class="keyword">typeof</span> objTypeDef ==<span class="string"><span class="delimiter">'</span><span class="content">object</span><span class="delimiter">'</span></span>){
                        <span class="keyword">if</span>(<span class="keyword">typeof</span> instance != <span class="string"><span class="delimiter">'</span><span class="content">object</span><span class="delimiter">'</span></span> || instance <span class="keyword">instanceof</span> Array){
                                errors.push({<span class="key">property</span>:path,<span class="key">message</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">an object is required</span><span class="delimiter">&quot;</span></span>});
                        }
                        
                        <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> objTypeDef){ 
                                <span class="keyword">if</span>(objTypeDef.hasOwnProperty(i)){
                                        <span class="keyword">var</span> value = instance[i];
                                        <span class="comment">// skip _not_ specified properties</span>
                                        <span class="keyword">if</span> (value === <span class="predefined-constant">undefined</span> &amp;&amp; options.existingOnly) <span class="keyword">continue</span>;
                                        <span class="keyword">var</span> propDef = objTypeDef[i];
                                        <span class="comment">// set default</span>
                                        <span class="keyword">if</span>(value === <span class="predefined-constant">undefined</span> &amp;&amp; propDef[<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>]){
                                                value = instance[i] = propDef[<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>];
                                        }
                                        <span class="keyword">if</span>(options.coerce &amp;&amp; i <span class="keyword">in</span> instance){
                                                value = instance[i] = options.coerce(value, propDef);
                                        }
                                        checkProp(value,propDef,path,i);
                                }
                        }
                }
                <span class="keyword">for</span>(i <span class="keyword">in</span> instance){
                        <span class="keyword">if</span>(instance.hasOwnProperty(i) &amp;&amp; !(i.charAt(<span class="integer">0</span>) == <span class="string"><span class="delimiter">'</span><span class="content">_</span><span class="delimiter">'</span></span> &amp;&amp; i.charAt(<span class="integer">1</span>) == <span class="string"><span class="delimiter">'</span><span class="content">_</span><span class="delimiter">'</span></span>) &amp;&amp; objTypeDef &amp;&amp; !objTypeDef[i] &amp;&amp; additionalProp===<span class="predefined-constant">false</span>){
                                <span class="keyword">if</span> (options.filter) {
                                        <span class="keyword">delete</span> instance[i];
                                        <span class="keyword">continue</span>;
                                } <span class="keyword">else</span> {
                                        errors.push({<span class="key">property</span>:path,<span class="key">message</span>:(<span class="keyword">typeof</span> value) + <span class="string"><span class="delimiter">&quot;</span><span class="content">The property </span><span class="delimiter">&quot;</span></span> + i +
                                                <span class="string"><span class="delimiter">&quot;</span><span class="content"> is not defined in the schema and the schema does not allow additional properties</span><span class="delimiter">&quot;</span></span>});
                                }
                        }
                        <span class="keyword">var</span> requires = objTypeDef &amp;&amp; objTypeDef[i] &amp;&amp; objTypeDef[i].requires;
                        <span class="keyword">if</span>(requires &amp;&amp; !(requires <span class="keyword">in</span> instance)){
                                errors.push({<span class="key">property</span>:path,<span class="key">message</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">the presence of the property </span><span class="delimiter">&quot;</span></span> + i + <span class="string"><span class="delimiter">&quot;</span><span class="content"> requires that </span><span class="delimiter">&quot;</span></span> + requires + <span class="string"><span class="delimiter">&quot;</span><span class="content"> also be present</span><span class="delimiter">&quot;</span></span>});
                        }
                        value = instance[i];
                        <span class="keyword">if</span>(additionalProp &amp;&amp; (!(objTypeDef &amp;&amp; <span class="keyword">typeof</span> objTypeDef == <span class="string"><span class="delimiter">'</span><span class="content">object</span><span class="delimiter">'</span></span>) || !(i <span class="keyword">in</span> objTypeDef))){
                                <span class="keyword">if</span>(options.coerce){
                                        value = instance[i] = options.coerce(value, additionalProp);
                                }
                                checkProp(value,additionalProp,path,i);
                        }
                        <span class="keyword">if</span>(!_changing &amp;&amp; value &amp;&amp; value.<span class="predefined">$schema</span>){
                                errors = errors.concat(checkProp(value,value.<span class="predefined">$schema</span>,path,i));
                        }
                }
                <span class="keyword">return</span> errors;
        }
        <span class="keyword">if</span>(schema){
                checkProp(instance,schema,<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,_changing || <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>);
        }
        <span class="keyword">if</span>(!_changing &amp;&amp; instance &amp;&amp; instance.<span class="predefined">$schema</span>){
                checkProp(instance,instance.<span class="predefined">$schema</span>,<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>);
        }
        <span class="keyword">return</span> {<span class="key">valid</span>:!errors.length,<span class="key">errors</span>:errors};
};
exports.<span class="function">mustBeValid</span> = <span class="keyword">function</span>(result){
        <span class="comment">//        summary:</span>
        <span class="comment">//                This checks to ensure that the result is valid and will throw an appropriate error message if it is not</span>
        <span class="comment">// result: the result returned from checkPropertyChange or validate</span>
        <span class="keyword">if</span>(!result.valid){
                <span class="keyword">throw</span> <span class="keyword">new</span> TypeError(result.errors.map(<span class="keyword">function</span>(error){<span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">for property </span><span class="delimiter">&quot;</span></span> + error.property + <span class="string"><span class="delimiter">'</span><span class="content">: </span><span class="delimiter">'</span></span> + error.message;}).join(<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="char">\n</span><span class="delimiter">&quot;</span></span>));
        }
}

<span class="keyword">return</span> exports;
});
</pre></td>
</tr></table>

</body>
</html>
